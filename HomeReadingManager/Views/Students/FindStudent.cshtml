@using HomeReadingManager.MyClasses;
@model HomeReadingManager.ViewModels.HomeReading
@using PagedList.Mvc;
@using PagedList;

<h2>Select Student</h2>
@{
    ViewBag.Title = "FindStudent";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using (Html.BeginForm("FindStudent", "Students", FormMethod.Get, new { id = "thisForm" }))
{
    @Html.HiddenFor(m => m.LibraryId)
    @Html.HiddenFor(m => m.StudentId, new { id = "selectedId" })
    <h4>
        @Html.DisplayFor(m => m.FilterName)
    </h4>
    <span id="btnCloseStudent" class="textLargeBlue">
        @Html.ActionLink("Close student", "SelectClass")
    </span>
    <table class="table">
        <tr style="height:35px">
            <th>
                @Html.ActionLink("M/F", "FindStudent", new
           {
               classId = Model.ClassId,
               className = Model.ClassName,
               search = Model.Search,
               newOrder = "Gender",
               sortOrder = Model.SortOrder,
               asc = Model.Ascending,
               libraryId = Model.LibraryId
           })
            </th>
            <th>
                @Html.ActionLink("Student", "FindStudent", new
           {
               classId = Model.ClassId,
               className = Model.ClassName,
               search = Model.Search,
               newOrder = "FirstName",
               sortOrder = Model.SortOrder,
               asc = Model.Ascending,
               libraryId = Model.LibraryId
           })
            </th>
            <th>
                @Html.ActionLink("Class", "FindStudent", new
           {
               classId = Model.ClassId,
               className = Model.ClassName,
               search = Model.Search,
               newOrder = "ClassName",
               sortOrder = Model.SortOrder,
               asc = Model.Ascending,
               libraryId = Model.LibraryId
           })
            </th>
            <th class="selectStudent" hidden="hidden"></th>
        </tr>
        @foreach (var item in Model.StudentHRs)
        {
            <tr id=@item.Id style="height:57px">
                <td>
                    @{
            if (item.Gender == "M")
            {
                <img src="~/Images/StudentBoy.jpg" width="31" height="40" />
            }
            else
            {
                <img src="~/Images/StudentGirl.jpg" width="31" height="40" />
            }
                    }
                </td>
                <td>
                    @item.FullName
                </td>
                <td>
                    @item.ClassName
                </td>
                <td>
                    @Html.NoEncodeActionLink("<span class='glyphicon glyphicon-hand-left'></span>", "Select student", "", "Students", routeValues: null,
                                                           htmlAttributes: new { @class = "btn btn-success selectStudent", @data_Id = item.Id })
                </td>

            </tr>
        }
    </table>
    <div id="dvPager">

        @Html.PagedListPager((IPagedList)Model.StudentHRs,
                         page => Url.Action("FindStudent", new
                         {
                             search = Model.Search,
                             sortOrder = Model.SortOrder,
                             asc = Model.Ascending,
                             libraryId = Model.LibraryId,
                             page = page
                         }),
                         PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(PagedListRenderOptions.PageNumbersOnly,
                                            new AjaxOptions
                                            {
                                                InsertionMode = InsertionMode.Replace,
                                                HttpMethod = "Get",
                                                UpdateTargetId = "dvPager"
                                            }))
    </div>
}
@section Scripts
{
    <script type="text/javascript">
        $(document).ready(function () {

            function set(value) {
                return value;
            }

            $(function () {
                $('.selectStudent').on('click', function (evt) {
                    evt.preventDefault();
                    evt.stopPropagation();
                    var id = $(this).data('id');
                    $('#selectedId').val(id);
                    $("#thisForm").submit();
                });
            });

        });
    </script>
}




